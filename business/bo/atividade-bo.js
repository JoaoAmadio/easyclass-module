"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AtividadeBO = void 0;
const typeorm_1 = require("typeorm");
const defaultDAO_1 = require("../core/dao/defaultDAO");
const atividade_1 = require("../../entities/atividade");
const atividadeAlunosUsuario_1 = require("../../entities/atividadeAlunosUsuario");
const disciplinaAlunosUsuario_1 = require("../../entities/disciplinaAlunosUsuario");
const respostaAtividade_1 = require("../../entities/respostaAtividade");
class AtividadeBO extends defaultDAO_1.DefaultDAO {
    constructor() {
        super();
        this.atividadeRepositorio = (0, typeorm_1.getRepository)(atividade_1.default);
    }
    async buscaPorCodigo2(codigoAtividade) {
        return this.atividadeRepositorio.findOne({
            where: { codigoAtividade }
        });
    }
    async buscaPorCodigo(codigoAtividade) {
        return this.atividadeRepositorio.createQueryBuilder("atividade")
            .innerJoinAndSelect("atividade.disciplina", "disciplina")
            .innerJoinAndSelect("atividade.autor", "autor")
            .innerJoinAndSelect("atividade.curso", "curso")
            .leftJoinAndSelect("atividade.alunos", "alunos")
            .leftJoinAndSelect("disciplina.alunos", "disciplina_alunos")
            .leftJoinAndSelect("curso.alunos", "curso_alunos")
            .leftJoinAndSelect("atividade.itensAtividade", "itensAtividade")
            .leftJoinAndSelect("itensAtividade.subitensItemAtividade", "subitensItemAtividade")
            .where("atividade.codigoAtividade = :codigoAtividade", { codigoAtividade }).getOne();
    }
    async listaRespostaAtividadeUsuarioDisciplina(idUsuario, idCurso, idDisciplina) {
        return (0, typeorm_1.getRepository)(respostaAtividade_1.default).createQueryBuilder("respostaAtividade")
            .innerJoinAndSelect("respostaAtividade.atividade", "atividade")
            .innerJoinAndSelect("respostaAtividade.aluno", "aluno")
            .innerJoinAndSelect("atividade.curso", "curso")
            .innerJoinAndSelect("atividade.disciplina", "disciplina")
            .innerJoinAndSelect("atividade.autor", "autor")
            .where("autor.idUsuario = :idUsuario AND curso.idCurso = :idCurso AND disciplina = :idDisciplina", { idUsuario, idCurso, idDisciplina })
            .getMany();
    }
    async listaAtividadeDisciplinaUsuario(idUsuario, idDisciplina) {
        return this.atividadeRepositorio.createQueryBuilder("atividade")
            .innerJoin(atividadeAlunosUsuario_1.default, "au", "au.atividadeIdAtividade = atividade.idAtividade")
            .innerJoin(disciplinaAlunosUsuario_1.default, "du", "du.usuarioIdUsuario = au.usuarioIdUsuario")
            .innerJoinAndSelect("au.usuario", "u")
            .innerJoinAndSelect("atividade.disciplina", "disciplina")
            .innerJoinAndSelect("atividade.autor", "autor")
            .innerJoinAndSelect("atividade.curso", "curso")
            .leftJoinAndSelect("atividade.alunos", "alunos")
            .leftJoinAndSelect("atividade.itensAtividade", "itensAtividade")
            .leftJoinAndSelect("itensAtividade.subitensItemAtividade", "subitensItemAtividade")
            .where("(autor.idUsuario = :idUsuario OR (atividade.disponivel = '1' AND u.idUsuario = :idUsuario)) AND disciplina.idDisciplina = :idDisciplina", { idUsuario, idDisciplina }).getMany();
    }
    async buscaRespostaPorAtividadeEAluno(aluno, atividade) {
        const { ra } = aluno;
        const { idAtividade } = atividade;
        return (0, typeorm_1.getRepository)(respostaAtividade_1.default).createQueryBuilder("respostaAtividade")
            .innerJoinAndSelect("respostaAtividade.atividade", "atividade")
            .innerJoinAndSelect("respostaAtividade.aluno", "aluno")
            .innerJoinAndSelect("atividade.disciplina", "disciplina")
            .innerJoinAndSelect("disciplina.professor", "professor")
            .innerJoinAndSelect("atividade.autor", "autor")
            .innerJoinAndSelect("atividade.curso", "curso")
            .leftJoinAndSelect("respostaAtividade.respostaAtividadeItens", "respostaAtividadeItens")
            .leftJoinAndSelect("respostaAtividadeItens.itemAtividade", "itemAtividade")
            .leftJoinAndSelect("itemAtividade.subitensItemAtividade", "itemAtividade_subitensItemAtividade")
            .leftJoinAndSelect("atividade.alunos", "alunos")
            .leftJoinAndSelect("atividade.itensAtividade", "itensAtividade")
            .leftJoinAndSelect("itensAtividade.subitensItemAtividade", "subitensItemAtividade")
            .where("(aluno.ra = :ra) AND atividade.idAtividade = :idAtividade", { ra, idAtividade }).getOne();
    }
    async buscaRespostaAtividadePorID(idRespostaAtividade) {
        return (0, typeorm_1.getRepository)(respostaAtividade_1.default).createQueryBuilder("respostaAtividade")
            .innerJoinAndSelect("respostaAtividade.atividade", "atividade")
            .innerJoinAndSelect("respostaAtividade.aluno", "aluno")
            .innerJoinAndSelect("atividade.disciplina", "disciplina")
            .innerJoinAndSelect("atividade.autor", "autor")
            .innerJoinAndSelect("atividade.curso", "curso")
            .leftJoinAndSelect("respostaAtividade.respostaAtividadeItens", "respostaAtividadeItens")
            .leftJoinAndSelect("respostaAtividadeItens.itemAtividade", "itemAtividade")
            .leftJoinAndSelect("itemAtividade.subitensItemAtividade", "itemAtividade_subitensItemAtividade")
            .leftJoinAndSelect("atividade.alunos", "alunos")
            .leftJoinAndSelect("atividade.itensAtividade", "itensAtividade")
            .leftJoinAndSelect("itensAtividade.subitensItemAtividade", "subitensItemAtividade")
            .where("respostaAtividade.idRespostaAtividade = :idRespostaAtividade", { idRespostaAtividade }).getOne();
    }
    async listaSimplesAtividadesPorCursoEDisciplina(curso, disciplina, autor) {
        const { idCurso } = curso;
        const { idDisciplina } = disciplina;
        const { idUsuario } = autor;
        return this.atividadeRepositorio.createQueryBuilder("atividade")
            .innerJoinAndSelect("atividade.disciplina", "disciplina")
            .innerJoinAndSelect("atividade.autor", "autor")
            .innerJoinAndSelect("atividade.curso", "curso")
            .where("autor.idUsuario = :idUsuario AND disciplina.idDisciplina = :idDisciplina AND curso.idCurso = :idCurso", { idUsuario, idDisciplina, idCurso })
            .getMany();
    }
}
exports.AtividadeBO = AtividadeBO;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXRpdmlkYWRlLWJvLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXRpdmlkYWRlLWJvLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLHFDQUFzQztBQUV0Qyx1REFBa0Q7QUFHbEQsd0RBQWlEO0FBQ2pELGtGQUFxRTtBQUNyRSxvRkFBdUU7QUFDdkUsd0VBQWlFO0FBRWpFLE1BQWEsV0FBWSxTQUFRLHVCQUFVO0lBRXZDO1FBQ0ksS0FBSyxFQUFFLENBQUM7UUFHTCx5QkFBb0IsR0FBRyxJQUFBLHVCQUFhLEVBQUMsbUJBQVMsQ0FBQyxDQUFDO0lBRnZELENBQUM7SUFJTSxLQUFLLENBQUMsZUFBZSxDQUFDLGVBQXVCO1FBQ2hELE9BQU8sSUFBSSxDQUFDLG9CQUFvQixDQUFDLE9BQU8sQ0FBQztZQUNyQyxLQUFLLEVBQUUsRUFBRSxlQUFlLEVBQUU7U0FDN0IsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUNNLEtBQUssQ0FBQyxjQUFjLENBQUMsZUFBdUI7UUFDL0MsT0FBTyxJQUFJLENBQUMsb0JBQW9CLENBQUMsa0JBQWtCLENBQUMsV0FBVyxDQUFDO2FBQzNELGtCQUFrQixDQUFDLHNCQUFzQixFQUFFLFlBQVksQ0FBQzthQUN4RCxrQkFBa0IsQ0FBQyxpQkFBaUIsRUFBRSxPQUFPLENBQUM7YUFDOUMsa0JBQWtCLENBQUMsaUJBQWlCLEVBQUUsT0FBTyxDQUFDO2FBQzlDLGlCQUFpQixDQUFDLGtCQUFrQixFQUFFLFFBQVEsQ0FBQzthQUMvQyxpQkFBaUIsQ0FBQyxtQkFBbUIsRUFBRSxtQkFBbUIsQ0FBQzthQUMzRCxpQkFBaUIsQ0FBQyxjQUFjLEVBQUUsY0FBYyxDQUFDO2FBQ2pELGlCQUFpQixDQUFDLDBCQUEwQixFQUFFLGdCQUFnQixDQUFDO2FBQy9ELGlCQUFpQixDQUFDLHNDQUFzQyxFQUFFLHVCQUF1QixDQUFDO2FBQ2xGLEtBQUssQ0FBQyw4Q0FBOEMsRUFBRSxFQUFFLGVBQWUsRUFBRSxDQUFDLENBQUMsTUFBTSxF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aUJBQWlCLEVBQUUsT0FBTyxDQUFDO2FBQzlDLGtCQUFrQixDQUFDLGlCQUFpQixFQUFFLE9BQU8sQ0FBQzthQUM5QyxLQUFLLENBQUMsdUdBQXVHLEVBQUUsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLE9BQU8sRUFBRSxDQUFDO2FBQ3BKLE9BQU8sRUFBRSxDQUFDO0lBQ2YsQ0FBQztDQUNKO0FBbEdELGtDQWtHQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Z2V0UmVwb3NpdG9yeX0gZnJvbSBcInR5cGVvcm1cIjtcclxuaW1wb3J0IFVzdWFyaW8gZnJvbSBcIi4uLy4uL2VudGl0aWVzL3VzdWFyaW9cIjtcclxuaW1wb3J0IHtEZWZhdWx0REFPfSBmcm9tIFwiLi4vY29yZS9kYW8vZGVmYXVsdERBT1wiO1xyXG5pbXBvcnQgQ3Vyc28gZnJvbSBcIi4uLy4uL2VudGl0aWVzL2N1cnNvXCI7XHJcbmltcG9ydCBEaXNjaXBsaW5hIGZyb20gXCIuLi8uLi9lbnRpdGllcy9kaXNjaXBsaW5hXCI7XHJcbmltcG9ydCBBdGl2aWRhZGUgZnJvbSBcIi4uLy4uL2VudGl0aWVzL2F0aXZpZGFkZVwiO1xyXG5pbXBvcnQgQXRpdmlkYWRlVXN1YXJpbyBmcm9tIFwiLi4vLi4vZW50aXRpZXMvYXRpdmlkYWRlQWx1bm9zVXN1YXJpb1wiO1xyXG5pbXBvcnQgRGlzY2lwbGluYVVzdWFyaW8gZnJvbSBcIi4uLy4uL2VudGl0aWVzL2Rpc2NpcGxpbmFBbHVub3NVc3VhcmlvXCI7XHJcbmltcG9ydCBSZXNwb3N0YUF0aXZpZGFkZSBmcm9tIFwiLi4vLi4vZW50aXRpZXMvcmVzcG9zdGFBdGl2aWRhZGVcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBBdGl2aWRhZGVCTyBleHRlbmRzIERlZmF1bHREQU97XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgc3VwZXIoKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYXRpdmlkYWRlUmVwb3NpdG9yaW8gPSBnZXRSZXBvc2l0b3J5KEF0aXZpZGFkZSk7XHJcblxyXG4gICAgcHVibGljIGFzeW5jIGJ1c2NhUG9yQ29kaWdvMihjb2RpZ29BdGl2aWRhZGU6IHN0cmluZyk6IFByb21pc2U8QXRpdmlkYWRlIHwgbnVsbD4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmF0aXZpZGFkZVJlcG9zaXRvcmlvLmZpbmRPbmUoe1xyXG4gICAgICAgICAgICB3aGVyZTogeyBjb2RpZ29BdGl2aWRhZGUgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcHVibGljIGFzeW5jIGJ1c2NhUG9yQ29kaWdvKGNvZGlnb0F0aXZpZGFkZTogc3RyaW5nKTogUHJvbWlzZTxBdGl2aWRhZGUgfCBudWxsPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYXRpdmlkYWRlUmVwb3NpdG9yaW8uY3JlYXRlUXVlcnlCdWlsZGVyKFwiYXRpdmlkYWRlXCIpXHJcbiAgICAgICAgICAgIC5pbm5lckpvaW5BbmRTZWxlY3QoXCJhdGl2aWRhZGUuZGlzY2lwbGluYVwiLCBcImRpc2NpcGxpbmFcIilcclxuICAgICAgICAgICAgLmlubmVySm9pbkFuZFNlbGVjdChcImF0aXZpZGFkZS5hdXRvclwiLCBcImF1dG9yXCIpXHJcbiAgICAgICAgICAgIC5pbm5lckpvaW5BbmRTZWxlY3QoXCJhdGl2aWRhZGUuY3Vyc29cIiwgXCJjdXJzb1wiKVxyXG4gICAgICAgICAgICAubGVmdEpvaW5BbmRTZWxlY3QoXCJhdGl2aWRhZGUuYWx1bm9zXCIsIFwiYWx1bm9zXCIpXHJcbiAgICAgICAgICAgIC5sZWZ0Sm9pbkFuZFNlbGVjdChcImRpc2NpcGxpbmEuYWx1bm9zXCIsIFwiZGlzY2lwbGluYV9hbHVub3NcIilcclxuICAgICAgICAgICAgLmxlZnRKb2luQW5kU2VsZWN0KFwiY3Vyc28uYWx1bm9zXCIsIFwiY3Vyc29fYWx1bm9zXCIpXHJcbiAgICAgICAgICAgIC5sZWZ0Sm9pbkFuZFNlbGVjdChcImF0aXZpZGFkZS5pdGVuc0F0aXZpZGFkZVwiLCBcIml0ZW5zQXRpdmlkYWRlXCIpXHJcbiAgICAgICAgICAgIC5sZWZ0Sm9pbkFuZFNlbGVjdChcIml0ZW5zQXRpdmlkYWRlLnN1Yml0ZW5zSXRlbUF0aXZpZGFkZVwiLCBcInN1Yml0ZW5zSXRlbUF0aXZpZGFkZVwiKVxyXG4gICAgICAgICAgICAud2hlcmUoXCJhdGl2aWRhZGUuY29kaWdvQXRpdmlkYWRlID0gOmNvZGlnb0F0aXZpZGFkZVwiLCB7IGNvZGlnb0F0aXZpZGFkZSB9KS5nZXRPbmUoKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYXN5bmMgbGlzdGFSZXNwb3N0YUF0aXZpZGFkZVVzdWFyaW9EaXNjaXBsaW5hKGlkVXN1YXJpbywgaWRDdXJzbywgaWREaXNjaXBsaW5hKTogUHJvbWlzZTxSZXNwb3N0YUF0aXZpZGFkZVtdIHwgbnVsbD4ge1xyXG4gICAgICAgIHJldHVybiBnZXRSZXBvc2l0b3J5KFJlc3Bvc3RhQXRpdmlkYWRlKS5jcmVhdGVRdWVyeUJ1aWxkZXIoXCJyZXNwb3N0YUF0aXZpZGFkZVwiKVxyXG4gICAgICAgICAgICAuaW5uZXJKb2luQW5kU2VsZWN0KFwicmVzcG9zdGFBdGl2aWRhZGUuYXRpdmlkYWRlXCIsIFwiYXRpdmlkYWRlXCIpXHJcbiAgICAgICAgICAgIC5pbm5lckpvaW5BbmRTZWxlY3QoXCJyZXNwb3N0YUF0aXZpZGFkZS5hbHVub1wiLCBcImFsdW5vXCIpXHJcbiAgICAgICAgICAgIC5pbm5lckpvaW5BbmRTZWxlY3QoXCJhdGl2aWRhZGUuY3Vyc29cIiwgXCJjdXJzb1wiKVxyXG4gICAgICAgICAgICAuaW5uZXJKb2luQW5kU2VsZWN0KFwiYXRpdmlkYWRlLmRpc2NpcGxpbmFcIiwgXCJkaXNjaXBsaW5hXCIpXHJcbiAgICAgICAgICAgIC5pbm5lckpvaW5BbmRTZWxlY3QoXCJhdGl2aWRhZGUuYXV0b3JcIiwgXCJhdXRvclwiKVxyXG4gICAgICAgICAgICAud2hlcmUoXCJhdXRvci5pZFVzdWFyaW8gPSA6aWRVc3VhcmlvIEFORCBjdXJzby5pZEN1cnNvID0gOmlkQ3Vyc28gQU5EIGRpc2NpcGxpbmEgPSA6aWREaXNjaXBsaW5hXCIsIHtpZFVzdWFyaW8sIGlkQ3Vyc28sIGlkRGlzY2lwbGluYX0pXHJcbiAgICAgICAgICAgIC5nZXRNYW55KCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGFzeW5jIGxpc3RhQXRpdmlkYWRlRGlzY2lwbGluYVVzdWFyaW8oaWRVc3VhcmlvOiBudW1iZXIsIGlkRGlzY2lwbGluYTogbnVtYmVyKTogUHJvbWlzZTxBdGl2aWRhZGVbXSB8IG51bGw+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5hdGl2aWRhZGVSZXBvc2l0b3Jpby5jcmVhdGVRdWVyeUJ1aWxkZXIoXCJhdGl2aWRhZGVcIilcclxuICAgICAgICAgICAgLmlubmVySm9pbihBdGl2aWRhZGVVc3VhcmlvLCBcImF1XCIsIFwiYXUuYXRpdmlkYWRlSWRBdGl2aWRhZGUgPSBhdGl2aWRhZGUuaWRBdGl2aWRhZGVcIilcclxuICAgICAgICAgICAgLmlubmVySm9pbihEaXNjaXBsaW5hVXN1YXJpbywgXCJkdVwiLCBcImR1LnVzdWFyaW9JZFVzdWFyaW8gPSBhdS51c3VhcmlvSWRVc3VhcmlvXCIpXHJcbiAgICAgICAgICAgIC5pbm5lckpvaW5BbmRTZWxlY3QoXCJhdS51c3VhcmlvXCIsIFwidVwiKVxyXG4gICAgICAgICAgICAuaW5uZXJKb2luQW5kU2VsZWN0KFwiYXRpdmlkYWRlLmRpc2NpcGxpbmFcIiwgXCJkaXNjaXBsaW5hXCIpXHJcbiAgICAgICAgICAgIC5pbm5lckpvaW5BbmRTZWxlY3QoXCJhdGl2aWRhZGUuYXV0b3JcIiwgXCJhdXRvclwiKVxyXG4gICAgICAgICAgICAuaW5uZXJKb2luQW5kU2VsZWN0KFwiYXRpdmlkYWRlLmN1cnNvXCIsIFwiY3Vyc29cIilcclxuICAgICAgICAgICAgLmxlZnRKb2luQW5kU2VsZWN0KFwiYXRpdmlkYWRlLmFsdW5vc1wiLCBcImFsdW5vc1wiKVxyXG4gICAgICAgICAgICAubGVmdEpvaW5BbmRTZWxlY3QoXCJhdGl2aWRhZGUuaXRlbnNBdGl2aWRhZGVcIiwgXCJpdGVuc0F0aXZpZGFkZVwiKVxyXG4gICAgICAgICAgICAubGVmdEpvaW5BbmRTZWxlY3QoXCJpdGVuc0F0aXZpZGFkZS5zdWJpdGVuc0l0ZW1BdGl2aWRhZGVcIiwgXCJzdWJpdGVuc0l0ZW1BdGl2aWRhZGVcIilcclxuICAgICAgICAgICAgLndoZXJlKFwiKGF1dG9yLmlkVXN1YXJpbyA9IDppZFVzdWFyaW8gT1IgKGF0aXZpZGFkZS5kaXNwb25pdmVsID0gJzEnIEFORCB1LmlkVXN1YXJpbyA9IDppZFVzdWFyaW8pKSBBTkQgZGlzY2lwbGluYS5pZERpc2NpcGxpbmEgPSA6aWREaXNjaXBsaW5hXCIsIHsgaWRVc3VhcmlvLCBpZERpc2NpcGxpbmEgfSkuZ2V0TWFueSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhc3luYyBidXNjYVJlc3Bvc3RhUG9yQXRpdmlkYWRlRUFsdW5vKGFsdW5vOiBVc3VhcmlvLCBhdGl2aWRhZGU6IEF0aXZpZGFkZSk6ICBQcm9taXNlPFJlc3Bvc3RhQXRpdmlkYWRlIHwgbnVsbD4gIHtcclxuICAgICAgICBjb25zdCB7IHJhIH0gPSBhbHVubztcclxuICAgICAgICBjb25zdCB7IGlkQXRpdmlkYWRlIH0gPSBhdGl2aWRhZGU7XHJcbiAgICAgICAgcmV0dXJuIGdldFJlcG9zaXRvcnkoUmVzcG9zdGFBdGl2aWRhZGUpLmNyZWF0ZVF1ZXJ5QnVpbGRlcihcInJlc3Bvc3RhQXRpdmlkYWRlXCIpXHJcbiAgICAgICAgICAgIC5pbm5lckpvaW5BbmRTZWxlY3QoXCJyZXNwb3N0YUF0aXZpZGFkZS5hdGl2aWRhZGVcIiwgXCJhdGl2aWRhZGVcIilcclxuICAgICAgICAgICAgLmlubmVySm9pbkFuZFNlbGVjdChcInJlc3Bvc3RhQXRpdmlkYWRlLmFsdW5vXCIsIFwiYWx1bm9cIilcclxuICAgICAgICAgICAgLmlubmVySm9pbkFuZFNlbGVjdChcImF0aXZpZGFkZS5kaXNjaXBsaW5hXCIsIFwiZGlzY2lwbGluYVwiKVxyXG4gICAgICAgICAgICAuaW5uZXJKb2luQW5kU2VsZWN0KFwiZGlzY2lwbGluYS5wcm9mZXNzb3JcIiwgXCJwcm9mZXNzb3JcIilcclxuICAgICAgICAgICAgLmlubmVySm9pbkFuZFNlbGVjdChcImF0aXZpZGFkZS5hdXRvclwiLCBcImF1dG9yXCIpXHJcbiAgICAgICAgICAgIC5pbm5lckpvaW5BbmRTZWxlY3QoXCJhdGl2aWRhZGUuY3Vyc29cIiwgXCJjdXJzb1wiKVxyXG4gICAgICAgICAgICAubGVmdEpvaW5BbmRTZWxlY3QoXCJyZXNwb3N0YUF0aXZpZGFkZS5yZXNwb3N0YUF0aXZpZGFkZUl0ZW5zXCIsIFwicmVzcG9zdGFBdGl2aWRhZGVJdGVuc1wiKVxyXG4gICAgICAgICAgICAubGVmdEpvaW5BbmRTZWxlY3QoXCJyZXNwb3N0YUF0aXZpZGFkZUl0ZW5zLml0ZW1BdGl2aWRhZGVcIiwgXCJpdGVtQXRpdmlkYWRlXCIpXHJcbiAgICAgICAgICAgIC5sZWZ0Sm9pbkFuZFNlbGVjdChcIml0ZW1BdGl2aWRhZGUuc3ViaXRlbnNJdGVtQXRpdmlkYWRlXCIsIFwiaXRlbUF0aXZpZGFkZV9zdWJpdGVuc0l0ZW1BdGl2aWRhZGVcIilcclxuICAgICAgICAgICAgLmxlZnRKb2luQW5kU2VsZWN0KFwiYXRpdmlkYWRlLmFsdW5vc1wiLCBcImFsdW5vc1wiKVxyXG4gICAgICAgICAgICAubGVmdEpvaW5BbmRTZWxlY3QoXCJhdGl2aWRhZGUuaXRlbnNBdGl2aWRhZGVcIiwgXCJpdGVuc0F0aXZpZGFkZVwiKVxyXG4gICAgICAgICAgICAubGVmdEpvaW5BbmRTZWxlY3QoXCJpdGVuc0F0aXZpZGFkZS5zdWJpdGVuc0l0ZW1BdGl2aWRhZGVcIiwgXCJzdWJpdGVuc0l0ZW1BdGl2aWRhZGVcIilcclxuICAgICAgICAgICAgLndoZXJlKFwiKGFsdW5vLnJhID0gOnJhKSBBTkQgYXRpdmlkYWRlLmlkQXRpdmlkYWRlID0gOmlkQXRpdmlkYWRlXCIsIHsgcmEsIGlkQXRpdmlkYWRlIH0pLmdldE9uZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhc3luYyBidXNjYVJlc3Bvc3RhQXRpdmlkYWRlUG9ySUQoaWRSZXNwb3N0YUF0aXZpZGFkZTogbnVtYmVyKTogIFByb21pc2U8UmVzcG9zdGFBdGl2aWRhZGUgfCBudWxsPiAge1xyXG4gICAgICAgIHJldHVybiBnZXRSZXBvc2l0b3J5KFJlc3Bvc3RhQXRpdmlkYWRlKS5jcmVhdGVRdWVyeUJ1aWxkZXIoXCJyZXNwb3N0YUF0aXZpZGFkZVwiKVxyXG4gICAgICAgICAgICAuaW5uZXJKb2luQW5kU2VsZWN0KFwicmVzcG9zdGFBdGl2aWRhZGUuYXRpdmlkYWRlXCIsIFwiYXRpdmlkYWRlXCIpXHJcbiAgICAgICAgICAgIC5pbm5lckpvaW5BbmRTZWxlY3QoXCJyZXNwb3N0YUF0aXZpZGFkZS5hbHVub1wiLCBcImFsdW5vXCIpXHJcbiAgICAgICAgICAgIC5pbm5lckpvaW5BbmRTZWxlY3QoXCJhdGl2aWRhZGUuZGlzY2lwbGluYVwiLCBcImRpc2NpcGxpbmFcIilcclxuICAgICAgICAgICAgLmlubmVySm9pbkFuZFNlbGVjdChcImF0aXZpZGFkZS5hdXRvclwiLCBcImF1dG9yXCIpXHJcbiAgICAgICAgICAgIC5pbm5lckpvaW5BbmRTZWxlY3QoXCJhdGl2aWRhZGUuY3Vyc29cIiwgXCJjdXJzb1wiKVxyXG4gICAgICAgICAgICAubGVmdEpvaW5BbmRTZWxlY3QoXCJyZXNwb3N0YUF0aXZpZGFkZS5yZXNwb3N0YUF0aXZpZGFkZUl0ZW5zXCIsIFwicmVzcG9zdGFBdGl2aWRhZGVJdGVuc1wiKVxyXG4gICAgICAgICAgICAubGVmdEpvaW5BbmRTZWxlY3QoXCJyZXNwb3N0YUF0aXZpZGFkZUl0ZW5zLml0ZW1BdGl2aWRhZGVcIiwgXCJpdGVtQXRpdmlkYWRlXCIpXHJcbiAgICAgICAgICAgIC5sZWZ0Sm9pbkFuZFNlbGVjdChcIml0ZW1BdGl2aWRhZGUuc3ViaXRlbnNJdGVtQXRpdmlkYWRlXCIsIFwiaXRlbUF0aXZpZGFkZV9zdWJpdGVuc0l0ZW1BdGl2aWRhZGVcIilcclxuICAgICAgICAgICAgLmxlZnRKb2luQW5kU2VsZWN0KFwiYXRpdmlkYWRlLmFsdW5vc1wiLCBcImFsdW5vc1wiKVxyXG4gICAgICAgICAgICAubGVmdEpvaW5BbmRTZWxlY3QoXCJhdGl2aWRhZGUuaXRlbnNBdGl2aWRhZGVcIiwgXCJpdGVuc0F0aXZpZGFkZVwiKVxyXG4gICAgICAgICAgICAubGVmdEpvaW5BbmRTZWxlY3QoXCJpdGVuc0F0aXZpZGFkZS5zdWJpdGVuc0l0ZW1BdGl2aWRhZGVcIiwgXCJzdWJpdGVuc0l0ZW1BdGl2aWRhZGVcIilcclxuICAgICAgICAgICAgLndoZXJlKFwicmVzcG9zdGFBdGl2aWRhZGUuaWRSZXNwb3N0YUF0aXZpZGFkZSA9IDppZFJlc3Bvc3RhQXRpdmlkYWRlXCIsIHsgaWRSZXNwb3N0YUF0aXZpZGFkZSB9KS5nZXRPbmUoKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYXN5bmMgbGlzdGFTaW1wbGVzQXRpdmlkYWRlc1BvckN1cnNvRURpc2NpcGxpbmEoY3Vyc286IEN1cnNvLCBkaXNjaXBsaW5hOiBEaXNjaXBsaW5hLCBhdXRvcjogVXN1YXJpbykge1xyXG4gICAgICAgIGNvbnN0IHtpZEN1cnNvfSA9IGN1cnNvO1xyXG4gICAgICAgIGNvbnN0IHtpZERpc2NpcGxpbmF9ID0gZGlzY2lwbGluYTtcclxuICAgICAgICBjb25zdCB7aWRVc3VhcmlvfSA9IGF1dG9yO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5hdGl2aWRhZGVSZXBvc2l0b3Jpby5jcmVhdGVRdWVyeUJ1aWxkZXIoXCJhdGl2aWRhZGVcIilcclxuICAgICAgICAuaW5uZXJKb2luQW5kU2VsZWN0KFwiYXRpdmlkYWRlLmRpc2NpcGxpbmFcIiwgXCJkaXNjaXBsaW5hXCIpXHJcbiAgICAgICAgLmlubmVySm9pbkFuZFNlbGVjdChcImF0aXZpZGFkZS5hdXRvclwiLCBcImF1dG9yXCIpXHJcbiAgICAgICAgLmlubmVySm9pbkFuZFNlbGVjdChcImF0aXZpZGFkZS5jdXJzb1wiLCBcImN1cnNvXCIpXHJcbiAgICAgICAgLndoZXJlKFwiYXV0b3IuaWRVc3VhcmlvID0gOmlkVXN1YXJpbyBBTkQgZGlzY2lwbGluYS5pZERpc2NpcGxpbmEgPSA6aWREaXNjaXBsaW5hIEFORCBjdXJzby5pZEN1cnNvID0gOmlkQ3Vyc29cIiwgeyBpZFVzdWFyaW8sIGlkRGlzY2lwbGluYSwgaWRDdXJzbyB9KVxyXG4gICAgICAgIC5nZXRNYW55KCk7XHJcbiAgICB9XHJcbn1cclxuIl19